<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="../dist/css/main.css">
    <title>Document</title>
    <script>window.$ = window.jQuery = require('jquery');</script>
</head>

<body>
    <div class="switcher">
        <button class="btn-secondary" data-change="add">Přidat</button>
        <button class="btn-secondary" data-change="filter">Filtrovat</button>
    </div>

    <button class="load-more btn-primary">Načíst více</button>
    <div class="active" data-item="add">
        <form id="add-article">
            <label for="title" class="label">Název</label>
            <input type="text" name="title" class="input">
            <label for="text" class="label">Text</label>
            <textarea type="text" name="text" class="input"></textarea>
            <label for="subtitle" class="label">Podtitulek</label>
            <input type="text" name="subtitle" class="input">
            <input type="submit" class="input" value="Odeslat článek">
        </form>
    </div>

    <div data-item="filter">
        <div>
            <label class="label">
                Podle datumu
            </label>
            <select name="filter_date">
                <option value="DESC">Od nejstaršího</option>
                <option value="ASC">Od nejmladšího</option>
            </select>
        </div>
        <div>
            Vyhledejte 
            <select name="filter_attr">
                <option value="title">Název</option>
                <option value="text">Text</option>
                <option value="subtitle">Podtitulku</option>
            </select>
        </div>

    </div>


    <section class="articles">
        <%- include('components/article_box.ejs', {articles: articles}); %>
    </section>

    <script>
        let ipcRenderer = require('electron').ipcRenderer;

        $("#add-article").submit((e) => {
            e.preventDefault();
            let formData = $("#add-article").serializeArray();
            ipcRenderer.send('submitForm', formData);
            $("#add-article").trigger("reset");
        });

        $(".switcher > button").click(function(e) {
            e.preventDefault();
            let change = $(this).data("change");
            $("[data-item]").removeClass();
            $(`[data-item="${change}"]`).addClass("active");
        });

        $('[data-item="filter"] select').change(function(e) {
            e.preventDefault();
            let selected = $(this).find("option:selected").val();
            ipcRenderer.send("getArticles", {"filter_date": selected});
            ipcRenderer.on('asynchronous-reply', (event, articles_html) => {
                $(".articles").html(articles_html);
            });
        });

        $(".load-more").click((e) => {
            e.preventDefault();
            let first_created = $("article").first().data("created");
            ipcRenderer.send("getArticles", first_created);
            ipcRenderer.on('asynchronous-reply', (event, articles_html) => {
                let old = $(".articles").html();
                let new_html = articles_html + old;
                $(".articles").html(new_html);
            })
        });
    </script>

</body>

</html>